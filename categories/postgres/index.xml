<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Postgres on Brian Walker's tecnotes</title><link>https://bdwalk.onrender.com/categories/postgres/</link><description>Recent content in Postgres on Brian Walker's tecnotes</description><generator>Hugo -- 0.148.2</generator><language>en-uk</language><lastBuildDate>Mon, 18 Aug 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://bdwalk.onrender.com/categories/postgres/index.xml" rel="self" type="application/rss+xml"/><item><title>Pgbackrest utilising a Azure Storage Account - Using a SAS Key - Part 2</title><link>https://bdwalk.onrender.com/posts/postgres_1882025_post1/</link><pubDate>Mon, 18 Aug 2025 00:00:00 +0000</pubDate><guid>https://bdwalk.onrender.com/posts/postgres_1882025_post1/</guid><description>&lt;p>This article shows you how to setup pgbackrest to utilise a azure storage account to store backups
and archived postgres wal logs.&lt;/p>
&lt;h2 id="steps">Steps&lt;/h2>
&lt;h6 id="1-retrieve-the-storage-account-key">1) Retrieve the Storage Account key.&lt;/h6>
&lt;p>account_key=$(az storage account keys list &lt;br>
&amp;ndash;resource-group &amp;ldquo;azureresourcegroup&amp;rdquo; &lt;br>
&amp;ndash;account-name &amp;ldquo;storage_account_name&amp;rdquo; &lt;br>
&amp;ndash;query &amp;ldquo;[0].value&amp;rdquo; &lt;br>
&amp;ndash;output tsv)&lt;/p>
&lt;h6 id="2-generate-the-storage-sas-token">2) Generate the Storage SAS token.&lt;/h6>
&lt;p>sas_token=$(az storage container generate-sas &lt;br>
&amp;ndash;account-name &amp;ldquo;storage_account_name&amp;rdquo; &lt;br>
&amp;ndash;name &amp;ldquo;container_name&amp;rdquo; &lt;br>
&amp;ndash;permissions acdlrw &lt;br>
&amp;ndash;expiry &amp;ldquo;expirydate&amp;rdquo; &lt;br>
&amp;ndash;https-only &lt;br>
&amp;ndash;account-key &amp;ldquo;account_key&amp;rdquo; &lt;br>
&amp;ndash;output tsv)&lt;/p>
&lt;h6 id="3-replace-the-old-token-with-the-new-token">3) Replace the old token with the new token&lt;/h6>
&lt;pre>&lt;code>awk -v sas_token=&amp;quot;$sas_token&amp;quot; '/^repo1-azure-key=/ {$0=&amp;quot;repo1-azure-key=&amp;quot; sas_token} {print}' &amp;quot;$pg_backrest_conf&amp;quot; &amp;gt; /tmp/pgbackrest.conf.tmp &amp;amp;&amp;amp; mv /tmp/pgbackrest.conf.tmp &amp;quot;$pg_backrest_conf&amp;quot;
&lt;/code>&lt;/pre>
&lt;h6 id="4-run-pgbackrest-backup">4) Run pgbackrest backup.&lt;/h6>
&lt;p>su - postgres&lt;br>
select pg_switch_wal(); select pg_switch_wal(); exit;&lt;br>
$ pgbackrest &amp;ndash;stanza=sname &amp;ndash;type=full backup&lt;/p></description></item><item><title>Pgbackrest utilising a Azure Storage Account - Using a SAS Key - Part 1</title><link>https://bdwalk.onrender.com/posts/postgres_0882025_post1/</link><pubDate>Sat, 09 Aug 2025 00:00:00 +0000</pubDate><guid>https://bdwalk.onrender.com/posts/postgres_0882025_post1/</guid><description>&lt;p>This article shows you how to setup pgbackrest to utilise a azure storage account to store backups
and archived postgres wal logs.&lt;/p>
&lt;h2 id="steps">Steps&lt;/h2>
&lt;h6 id="1-create-storage-account">1) Create Storage Account&lt;/h6>
&lt;p>First, setup a Azure Storage Account, either using Terraform, ARM Template Azure Cli, or via Azure Portal.&lt;/p>
&lt;p>Mandatory settings for the Azure Storage Account.&lt;/p>
&lt;p>Resouce Group - Name of your resource group.
&lt;br />
Storage Account Name - Name of storage account.
&lt;br />
Region - Your deployment Region.
&lt;br />
Primary Service - Azure Blob Storage or Azure Data Lake Storage Gen 2.
&lt;br />
Enable Storage account key access.&lt;/p></description></item></channel></rss>