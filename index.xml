<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Brian Walker's tecnotes</title><link>https://bdwalk.onrender.com/</link><description>Recent content on Brian Walker's tecnotes</description><generator>Hugo -- 0.151.2</generator><language>en-uk</language><lastBuildDate>Sun, 12 Oct 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://bdwalk.onrender.com/index.xml" rel="self" type="application/rss+xml"/><item><title>Identifing IO performance problem with iostat.</title><link>https://bdwalk.onrender.com/posts/iostat_121025/</link><pubDate>Sun, 12 Oct 2025 00:00:00 +0000</pubDate><guid>https://bdwalk.onrender.com/posts/iostat_121025/</guid><description>&lt;p&gt;Quick article, what to look for when assessing iostat output due to slow performance on a database ( DB2, MySQL, Postgres, Oracle ) server. If you observed CPU run queue been blocked/high software interrupts. Here is a sample output iostat where I diagnose wait IO root cause of a database hang , which was wait IO -&lt;/p&gt;
&lt;h2 id="if-you-observe"&gt;If you observe&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;$ iostat -kxy 10 1
Linux 4.18.0-553.61.1.el8_10.x86_64 (hostname) 10/06/2025 _x86_64_ (32 CPU)
10/06/25 16:31:50
avg-cpu: %user %nice %system %iowait %steal %idle
7.87 0.00 0.00 3.53 0.00 85.28
Device r/s w/s rkB/s wkB/s rrqm/s wrqm/s %rrqm %wrqm r_await w_await aqu-sz rareq-sz wareq-sz svctm %util
etc
sdd 1.32 3.11 21.93 62.34 0.0 0.01 0.4 0.47 4.46 78.46 0.25 16.62 20.04 4.75 2.211
etc
sdl 1.31 3.11 21.93 21.94 0.0 0.01 0.3 0.47 4.46 78.09 0.25 16.62 20.04 4.75 2.211
etc
$ cat /sys/block/sdl/device/queue_depth
64
$ cat /sys/block/sdd/device/queue_depth
64
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Figure 1&lt;/p&gt;</description></item><item><title>Arctera[Veritas] Storage Foundation : Identify LUN of DMP ( Dynamic Multipath) device.</title><link>https://bdwalk.onrender.com/posts/veritas_300925_post1/</link><pubDate>Wed, 01 Oct 2025 00:00:00 +0000</pubDate><guid>https://bdwalk.onrender.com/posts/veritas_300925_post1/</guid><description>&lt;p&gt;This article shows you how to identify LUN ID that maps to a Arctera[Veritas] Storage Foundation DMP ( Dynamic Multipath).&lt;/p&gt;
&lt;h2 id="steps"&gt;Steps&lt;/h2&gt;
&lt;h6 id="1--list-fibre-cards-and-encloser-details-for-future-reference"&gt;1) List fibre cards and encloser details for future reference.&lt;/h6&gt;
&lt;pre&gt;&lt;code&gt;From your Linux shell
# systool -c fc_host -v |egrep &amp;quot;Class Devic|port_name|port_state|port_id&amp;quot;
Class Device = &amp;quot;host11&amp;quot;
Device path = &amp;quot;/sys/devices/pci0000:00/0000:00:04.0/0000:08:00.0/host11&amp;quot;
port_id = &amp;quot;0x000000&amp;quot;
port_name = &amp;quot;0x210000e08b8068ae&amp;quot;
port_state = &amp;quot;LinkDown&amp;quot;
Class Device = &amp;quot;host13&amp;quot;
Device path = &amp;quot;/sys/devices/pci0000:00/0000:00:04.0/0000:08:00.0/host13&amp;quot;
port_id = &amp;quot;0x000000&amp;quot;
port_name = &amp;quot;0x210000e08b8068ae&amp;quot;
port_state = &amp;quot;Online&amp;quot;
Class Device = &amp;quot;host14&amp;quot;
Device path = &amp;quot;/sys/devices/pci0000:00/0000:00:04.0/0000:08:00.0/host10&amp;quot;
port_id = &amp;quot;0x000000&amp;quot;
port_name = &amp;quot;0x210000e08b8068ae&amp;quot;
port_state = &amp;quot;Linkdown&amp;quot;
Class Device = &amp;quot;host3&amp;quot;
Device path = &amp;quot;/sys/devices/pci0000:00/0000:00:04.0/0000:08:00.0/host3&amp;quot;
port_id = &amp;quot;0x000000&amp;quot;
port_name = &amp;quot;0x210000e08b8068ae&amp;quot;
port_state = &amp;quot;Online&amp;quot;
#xmdmpadm listenclosure all
ENCLR_NAME ENCLR_TYPE ENCLR_SN Status ARRARY_TYPE LUN COUNT FIRMWARE
emc1 EMC 000297800422 CONNECTED VMAX-A/A 14 5978
disk Disk DISKS CONNECTED Disk 1 5.26
&lt;/code&gt;&lt;/pre&gt;
&lt;h6 id="2-identify-dmpnodename"&gt;2) Identify dmpnodename&lt;/h6&gt;
&lt;pre&gt;&lt;code&gt;# df -h |grep cluster
# /dev/vx/dsk/RS_cluster_T2/lv_cluster 32GB 1.4G 31 5% /cluster
# vxdg list RS_cluster_T2
Group: RS_cluster_T2
dgid : 1716266100.420.hkl2135435
import-id : 1024.41
version: 290
aligment : 8192 (bytes)
local_activation: read-write
ssb: on
autotagging : on
copies: nconfig=default nlog=default
config: seqno=0.1158 permlen=51360 free=51360 templen=4 loglen=4096
config disk emc1_16f9 copy 1 len=51360 state=clean online
log disk emc1_16f9 copy 1 len=4096
&lt;/code&gt;&lt;/pre&gt;
&lt;h6 id="3-use-vxdmpadm-getsubpaths-to-identify-the-os-devices-that-represents-the-paths-to-your-lun"&gt;3) Use vxdmpadm getsubpaths to identify the OS devices that represents the paths to your LUN.&lt;/h6&gt;
&lt;pre&gt;&lt;code&gt;# vxdmpadm getsubpaths dmpnodename=emc1_16f9 # ( dmpnodename DEVICE)
NAME STATE[A] PATH-TYPE[M] CTL_NAME ENCLR_TYPE ENCLR_NAME ATTRS Priority
sdav ENABLED[A] - c3 EMC emc1 - -
sdbj ENABLED[A] - c13 EMC emc1 - -
sdl ENABLED[A] - c13 EMC emc1 - -
sdz ENABLED[A] - c3 EMC emc1 - -
&lt;/code&gt;&lt;/pre&gt;
&lt;h6 id="3-either-use"&gt;3) Either use&lt;/h6&gt;
&lt;pre&gt;&lt;code&gt;#ls -ld /sys/block/sd*/device |grep -e sdz -e sdl -e sdbj -e sdav
* ^
lrwxrwxrwx. 1 root root 0 Aug 21 14:47 /sys/block/sdav/device ../../../13:0:2:3
lrwxrwxrwx. 1 root root 0 Aug 21 14:47 /sys/block/sdaj/device ../../../13:0:3:3
lrwxrwxrwx. 1 root root 0 Aug 21 14:47 /sys/block/sdl/device ../../../3:0:2:3
lrwxrwxrwx. 1 root root 0 Aug 21 14:47 /sys/block/sdz/device ../../../3:0:3:3 **
Key * Each host id 13, and 3 ( See systool outout ) Class Device = &amp;quot;host13&amp;quot;, and Class Device = &amp;quot;host3&amp;quot;
^ LUN ID
#sg_map -x -sd |grep sdz
/dev/sg25 3 0 3 3 0 /dev/sdz
#sg_map -x -sd |grep sdav
/dev/sg25 13 0 2 3 0 /dev/sdav
etc for sdl and sdbj
Notes, on sg_map -x
after each active sg device name is displayed there are five digits: &amp;lt;host_number&amp;gt; &amp;lt;bus&amp;gt; &amp;lt;scsi_id&amp;gt; &amp;lt;lun&amp;gt; &amp;lt;scsi_type&amp;gt; e.g. 3 0 3 3 0, and 13 0 2 3 0 in example above.
or
#lsblk -S |grep sdz
sdz 3:0:3:3 disk EMC SYMETRIX 5978 fc
* ^
* Host from systools
^ LUN ID
Then get fdisk /dev/sdz Get Disk size. This will also help to find the Lun within the Storage Array !
So you LUN ID is 3, on EMC SYMETRIX array with firmware 5978.
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>Pgbackrest utilising a Azure Storage Account - Using a SAS Key - Part 2</title><link>https://bdwalk.onrender.com/posts/postgres_1882025_post1/</link><pubDate>Mon, 18 Aug 2025 00:00:00 +0000</pubDate><guid>https://bdwalk.onrender.com/posts/postgres_1882025_post1/</guid><description>&lt;p&gt;This article shows you how to Generate the Storage SAS token, and update the PgBackrest Config file. It
also describes items to consider if you want to use Azure Storage Account using SAS keys
for authentication &amp;amp; Pgbackrest.&lt;/p&gt;
&lt;h2 id="steps"&gt;Steps&lt;/h2&gt;
&lt;h6 id="1-retrieve-the-storage-account-key"&gt;1) Retrieve the Storage Account key.&lt;/h6&gt;
&lt;pre&gt;&lt;code&gt;account_key=$(az storage account keys list \
--resource-group &amp;quot;azureresourcegroup&amp;quot; \
--account-name &amp;quot;storage_account_name&amp;quot; \
--query &amp;quot;[0].value&amp;quot; \
--output tsv)
&lt;/code&gt;&lt;/pre&gt;
&lt;h6 id="2-generate-the-storage-sas-token"&gt;2) Generate the Storage SAS token.&lt;/h6&gt;
&lt;pre&gt;&lt;code&gt;sas_token=$(az storage container generate-sas \
--account-name &amp;quot;storage_account_name&amp;quot; \
--name &amp;quot;container_name&amp;quot; \
--permissions acdlrw \
--expiry &amp;quot;expirydate&amp;quot; \
--https-only \
--account-key &amp;quot;account_key&amp;quot; \
--output tsv)
&lt;/code&gt;&lt;/pre&gt;
&lt;h6 id="3-replace-the-old-token-with-the-new-token"&gt;3) Replace the old token with the new token&lt;/h6&gt;
&lt;pre&gt;&lt;code&gt;awk -v sas_token=&amp;quot;$sas_token&amp;quot; '/^repo1-azure-key=/ {$0=&amp;quot;repo1-azure-key=&amp;quot; sas_token} {print}' &amp;quot;$pg_backrest_conf&amp;quot; &amp;gt; /tmp/pgbackrest.conf.tmp &amp;amp;&amp;amp; mv /tmp/pgbackrest.conf.tmp &amp;quot;$pg_backrest_conf&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h6 id="4-run-pgbackrest-backup"&gt;4) Run pgbackrest backup.&lt;/h6&gt;
&lt;p&gt;su - postgres&lt;br&gt;
select pg_switch_wal(); select pg_switch_wal(); exit;&lt;br&gt;
$ pgbackrest &amp;ndash;stanza=sname &amp;ndash;type=full backup&lt;/p&gt;</description></item><item><title>Pgbackrest utilising a Azure Storage Account - Using a SAS Key - Part 1</title><link>https://bdwalk.onrender.com/posts/postgres_0882025_post1/</link><pubDate>Sat, 09 Aug 2025 00:00:00 +0000</pubDate><guid>https://bdwalk.onrender.com/posts/postgres_0882025_post1/</guid><description>&lt;p&gt;This article shows you how to setup pgbackrest to utilise a azure storage account to store backups
and archived postgres wal logs.&lt;/p&gt;
&lt;h2 id="steps"&gt;Steps&lt;/h2&gt;
&lt;h6 id="1-create-storage-account"&gt;1) Create Storage Account&lt;/h6&gt;
&lt;p&gt;First, setup a Azure Storage Account, either using Terraform, ARM Template Azure Cli, or via Azure Portal.&lt;/p&gt;
&lt;p&gt;Mandatory settings for the Azure Storage Account.&lt;/p&gt;
&lt;p&gt;Resouce Group - Name of your resource group.
&lt;br /&gt;
Storage Account Name - Name of storage account.
&lt;br /&gt;
Region - Your deployment Region.
&lt;br /&gt;
Primary Service - Azure Blob Storage or Azure Data Lake Storage Gen 2.
&lt;br /&gt;
Enable Storage account key access.&lt;/p&gt;</description></item><item><title>Postgres pg_service file</title><link>https://bdwalk.onrender.com/posts/postgres_3172025_post1/</link><pubDate>Thu, 31 Jul 2025 00:00:00 +0000</pubDate><guid>https://bdwalk.onrender.com/posts/postgres_3172025_post1/</guid><description>&lt;h2 id="what-is-the-pg_service-file-"&gt;What is the pg_service file ?&lt;/h2&gt;
&lt;p&gt;This article highlights the importance of the Postgres pg_service file (pg_service.conf). The pg_service file allows libpq connection parameters to be associated with a single service name as part of command argument or when setting PGSERVICE environment variable. In the Next section , are some examples with s &amp;lsquo;service&amp;rsquo; be used.&lt;/p&gt;
&lt;h2 id="commmand-line-examples"&gt;Commmand Line examples&lt;/h2&gt;
&lt;p&gt;pg_basebackup &amp;ndash;pgdata=$PGDATA &amp;ndash;dbname=service=basebackup &amp;ndash;verbose &amp;ndash;progress &amp;ndash;checkpoint=fast &amp;ndash;write-recovery-conf &amp;ndash;wal-method=stream &amp;ndash;waldir=/psql/pglog/13 &amp;ndash;create-slot &amp;ndash;slot=pgstandby2&lt;/p&gt;</description></item><item><title>My first blog post</title><link>https://bdwalk.onrender.com/posts/test_3072025_post1/</link><pubDate>Wed, 30 Jul 2025 00:00:00 +0000</pubDate><guid>https://bdwalk.onrender.com/posts/test_3072025_post1/</guid><description>&lt;p&gt;Hi first blog!&lt;/p&gt;</description></item></channel></rss>